<%- include('../userIncludes/header') %>

  </head>

  <body>
    <%- include('../userIncludes/nav') %>

      <div class="" style="min-height: 90vh ;">
        <div class="container">
          <div class="d-flex my-5 justify-content-between ">
            <div class="w-75">
              <div class="m-4 ">
                <div>
                  <h3>Add Address</h3>
                  <form action="/addAddress/<%= userId %> " method="post">
                    <div class="mb-3">
                      <input type="text" class="form-control" name="name" placeholder="Name" required>
                    </div>
                    <div class="mb-3">
                      <input type="text" class="form-control" name="address" placeholder="Address" required>
                    </div>
                    <div class="mb-3">
                      <input type="text" class="form-control" name="zipCode" placeholder="Zip Code" required>
                    </div>
                    <div class="mb-3">
                      <input type="text" class="form-control" name="mobileNumber" placeholder="Mobile Number" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add</button>
                  </form>
                </div>

                <div class="my-5">

                  <h4>Saved Address</h4>

                  <div class="mx-3 my-4">


                    <form action="" id="checkout-form">
                      <% for(address of savedAddress){ %>
                        <div class=" border mt-2">

                          <input type="radio" id="address<%=address.name%>" name="address" value="<%=address._id%>"
                            required>
                          <label for="address<%=address.name%>" class="">
                            <div class="ms-5">
                              <p>
                                <%= address.name%>
                              </p>
                              <p>
                                <%=address.mobileNumber%>
                              </p>
                              <p>Address : <%= address.address%>
                              </p>
                              <p>Zipcode : <%= address.zipCode%>
                              </p>
                            </div>
                          </label>

                        </div>
                        <% } %>

                          <br>
                          <br>
                          <hr>
                          <input type="radio" id="codPayment" name="paymentMethod" value="cod" required>
                          <label for="codPayment">COD</label>
                          <br>
                          <input type="radio" id="onlinePayment" name="paymentMethod" value="onlinePayment" required>
                          <label for="onlinePayment">Online Payment</label>
                          <br>
                          <br>
                          <input type="submit" value="Submit">
                    </form>







                  </div>

                </div>


              </div>
            </div>
            <!-- <div class="w-25 ">
                <div class="m-4 border">
                
                    <h4>Cart Total</h4>
                    <h6></h6>
                    <button>Proceed to buy  (Item Number)</button>

                </div>
            </div> -->
          </div>
        </div>

      </div>






      <%- include('../userIncludes/footer') %>

        <script src="https://code.jquery.com/jquery-3.6.1.js"
          integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

        <script>
          $("#checkout-form").submit((e) => {
            e.preventDefault()
            $.ajax({
              url: '/placeOrder',
              method: 'post',
              data: $('#checkout-form').serialize(),
              success: (response) => {
                // alert(response)  
                if (response != false) {
                  console.log(response);
                  razorpayPayment(response)


                  // location.href = '/onlinePayment'
                }
              }
            })
          })

           function razorpayPayment (order) {
            console.log(order);
            var options = {
              "key": "rzp_test_nskbaOm2bho9QL", // Enter the Key ID generated from the Dashboard
              "amount": "50000", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
              "currency": "INR",
              "name": "Decor",
              "description": "Test Transaction",
              "image": "https://example.com/your_logo",
              "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
              // "callback_url": "https://eneqd3r9zrjok.x.pipedream.net/",
              "handler": function (response){
                 
                    // alert(response.razorpay_payment_id);
                    // alert(response.razorpay_order_id);
                    // alert(response.razorpay_signature)
                    
                    verifyPayment(response, order);
                },
              "prefill": {
                "name": "Gaurav Kumar",
                "email": "gaurav.kumar@example.com",
                "contact": "9999999999"
              },
              "notes": {
                "address": "Razorpay Corporate Office"
              },
              "theme": {
                "color": "#3399cc"
              }
            };
            var rzp1 = new Razorpay(options);
              rzp1.open();
          }


          function verifyPayment (payment,order){
            console.log(payment);
            console.log("dsadas");
            console.log(order);
            $.ajax({
              url:'/verifyPayment',
              data:{
                payment,
                order
              },
              method:'post'
            })
          }

        </script>




        <%- include('../userIncludes/bodyEnd') %>